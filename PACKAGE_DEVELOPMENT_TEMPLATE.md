# CDM Methodology Package Development Template

This repository hosts a collection of R packages implementing CDM methodologies. Every package **must** follow the conventions in this document to ensure consistency across the ecosystem.

## 1. General Structure
- Each methodology lives in its own installable R package stored in a dedicated subdirectory of the repository root.
- Package names should be lowercase, hyphen-free, and prefixed with `cdm` (e.g. `cdm-methane-leaks` becomes `cdmmethaneleaks`).
- Packages must adopt the standard R package layout generated by `usethis::create_package()`.
- Include a `DESCRIPTION` file with complete metadata, dependencies, and authorship information.

## 2. Dependencies and Integration
- Depend on the **tidyverse** meta-package to ensure seamless integration with the tidyverse family of packages. Prefer tidyverse-native tools (`dplyr`, `tidyr`, `stringr`, `purrr`, etc.) for data manipulation, string handling, and functional programming.
- Use `DeclareDesign` for simulation tasks. Add it to the `Suggests` field of `DESCRIPTION` and conditionally load it within examples/tests.
- Any additional dependencies must be justified in package documentation.

## 3. Function Design Requirements
- Translate **every numbered equation** in the methodology documentation into a dedicated R function stored under `R/`.
- Provide **meta-functions** that orchestrate the full calculation by composing the equation-level functions.
- Implement helper functions that evaluate **quantitative applicability conditions** described in the methodology.
- All functions must:
  - Accept tidy data frames (tibbles) as appropriate and return tidyverse-compatible structures.
  - Be vectorised where possible and avoid hidden state.
  - Contain complete `@param`, `@return`, `@examples`, and `@seealso` tags in their Roxygen documentation. Use parameter descriptions to reference outputs from related functions when arguments depend on previous results.

## 4. Documentation Standards
- Use **Roxygen2** for all function documentation. Run `devtools::document()` (or `roxygen2::roxygenise()`) to generate Rd files before committing.
- Each package requires a `pkgdown`-ready `README.Rmd` summarising the methodology, inputs, outputs, and tidyverse alignment.
- Maintain a NEWS.md changelog with semantic versioning notes.

## 5. Testing and Quality Assurance
- Provide unit tests in `tests/testthat/` for **every** function, including numerical tolerances for equation implementations and end-to-end tests for meta-functions.
- Test applicability-condition functions with both valid and invalid inputs.
- Ensure simulated datasets generated by DeclareDesign are validated within tests (e.g. checking column presence and summary statistics).
- Configure continuous integration (e.g. GitHub Actions) to run `R CMD check --as-cran` for each package.

## 6. Simulation Utilities
- Each package must expose at least one `simulate_*()` function that creates a test dataset using `DeclareDesign` reflecting the methodology's data requirements.
- Document simulation parameters and default values, emphasising tidyverse compatibility.

## 7. Vignettes
- Create a vignette (`vignettes/<package>-methodology.Rmd`) that includes:
  - A narrative description of the methodology and its data requirements.
  - A walkthrough using the simulated dataset and all equation-level functions plus the meta-function.
  - A diagram (e.g. Mermaid flowchart) showing function interdependencies and data flow.
  - A function reference table linking to documentation.

## 8. Workflow Checklist
1. Generate the package skeleton with `usethis::create_package()`.
2. Implement equation functions, meta-functions, and applicability checks under `R/`.
3. Add Roxygen documentation with tidyverse-focused parameter descriptions.
4. Create DeclareDesign-based simulation utilities.
5. Write unit tests for all functionality using `testthat`.
6. Produce a vignette with narrative, examples, and a diagram.
7. Run `devtools::document()` and `devtools::check()`.
8. Update README, NEWS, and pkgdown configuration as needed.
9. Commit changes and open a PR summarising updates.

Adhering to this template ensures every CDM methodology package remains consistent, well-documented, and immediately usable by analysts working within the tidyverse ecosystem.
