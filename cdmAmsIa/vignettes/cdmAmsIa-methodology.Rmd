
---
title: "AMS-I.A Methodology Walkthrough"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{AMS-I.A Methodology Walkthrough}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Introduction

This vignette demonstrates how to reproduce the AMS-I.A calculations using `cdmAmsIa`. The
methodology covers on-site renewable electricity systems that displace fossil electricity
consumption by the end user. The core steps involve calculating baseline generation, estimating
emissions using a grid factor, and confirming negligible project emissions.

# Applicability Checks

```{r applicability}
library(cdmAmsIa)
check_applicability_installed_capacity(capacity_kw = 1000, renewable_fraction = 1)
check_applicability_distributed_generation(fossil_fraction_baseline = 0.85)
```

# Simulated Dataset

```{r simulation}
set.seed(123)
example_data <- simulate_ams_ia_dataset(n_users = 10)
head(example_data)
```

# Equation Walkthrough

```{r calculations}
baseline_gen <- calculate_baseline_generation(example_data, group_cols = "user_id")
baseline_emis <- calculate_baseline_emissions(baseline_gen, grid_emission_factor = 0.75)
project_emis <- calculate_project_emissions(baseline_gen)
emission_reductions <- calculate_emission_reductions(baseline_emis, project_emis)
head(emission_reductions)
```

# Meta-Function

```{r meta}
estimate_emission_reductions_ams_ia(
  generation_data = example_data,
  grid_emission_factor = 0.75,
  group_cols = "user_id"
)
```

# Function Reference

| Function | Purpose |
|----------|---------|
| `calculate_baseline_generation()` | Equation (1): Aggregates electricity generation |
| `calculate_baseline_emissions()` | Equation (2): Baseline emissions |
| `calculate_project_emissions()` | Equation (3): Project emissions |
| `calculate_emission_reductions()` | Equation (4): Emission reductions |
| `estimate_emission_reductions_ams_ia()` | Meta-calculation |
| `simulate_ams_ia_dataset()` | DeclareDesign-based simulation |

# Workflow Diagram

```{mermaid}
flowchart TD
  A[Input generation data] --> B[calculate_baseline_generation]
  B --> C[calculate_baseline_emissions]
  B --> D[calculate_project_emissions]
  C --> E[calculate_emission_reductions]
  D --> E
  E --> F[estimate_emission_reductions_ams_ia]
```
